<!doctype html>
<html lang="en-US">
	<head>
		<meta charset="utf-8" />
		<title>PONG</title>
		<style>
* {
	padding: 0;
	margin: 0;
}
      canvas {
	      background: #eee;
	      display: block;
	      margin: 0 auto;
      }
		</style>
	</head>
	<body>
		<canvas id="myCanvas" width="1080" height="720"></canvas>

		<script>
			const canvas = document.getElementById("myCanvas");
			const ctx = canvas.getContext("2d");
			let x = canvas.width / 2;
			let y = canvas.height - 10;
			let dx = (canvas.width / 2) / 200;
			let dy = -1 * ((canvas.height / 2) / 200);
			const ballRadius = 10;
			const paddleHeight = canvas.height / 4.5;
			const paddleWidth = 10;
			let leftPaddle = (canvas.height - paddleHeight) / 2;
			let rightPaddle = (canvas.height - paddleHeight) / 2;
			let leftPaddleRightPressed = false;
			let leftPaddleLeftPressed = false;
			let rightPaddleRightPressed = false;
			let rightPaddleLeftPressed = false;
			let interval = 0;
			let leftScore = 0;
			let rightScore = 0;
			let relativeIntersectionY = 0;
			let normalizedIntersectionY = 0;
			let bounceAngle = 0;
			let ballSpeed = canvas.width / 250;
			let boxHover = false;
			let menuBool = true;
			let player1 = "Player 1";
			let player2 = "Player 2";
			let winner = 0;

			function resetGame()
			{
				x = canvas.width / 2;
				y = canvas.height - 10;
				dx = (canvas.width / 2) / 200;
				dy = -1 * ((canvas.height / 2) / 200);
				leftPaddle = (canvas.height - paddleHeight) / 2;
				rightPaddle = (canvas.height - paddleHeight) / 2;
				leftScore = 0;
				rightScore = 0;
				ballSpeed = canvas.width / 250;
				menuBool = true;
			}

			function drawMenu()
			{
				ctx.clearRect(0, 0, canvas.width, canvas.height);
				drawStartSoloMenu();
				if (winner != 0)
					drawMenuScore();
			}

			function drawStartSoloMenu()
			{
				drawStartSoloMenuBox();
				if (boxHover === true)
					drawStartSoloMenuBoxHover();
				drawStartSoloMenuText();
			}

			function drawStartSoloMenuBox()
			{
				ctx.fillStyle = "#0095DD";
				ctx.beginPath();
				ctx.roundRect((canvas.width / 3), (canvas.height / 3), (canvas.width / 3), (canvas.height / 3), 50);
				ctx.fill();
				ctx.shadowBlur = 0;
			}

			function drawStartSoloMenuBoxHover()
			{
				ctx.fillStyle = "#0095DD";
				ctx.beginPath();
				ctx.roundRect((canvas.width / 3), (canvas.height / 3), (canvas.width / 3), (canvas.height / 3), 50);
				ctx.shadowColor = "#FFFFFF";
				ctx.shadowBlur = 50;
				ctx.fill();
			}

			function drawStartSoloMenuText()
			{
				ctx.font = canvas.height/6 + "px Arial";
				ctx.fillStyle = "#ffffff";
				ctx.textAlign="center";
				ctx.textBaseline = "middle";
				ctx.fillText(`PLAY`, canvas.width / 2, (canvas.height / 2));
			}

			function drawMenuScore()
			{
				ctx.font = canvas.height/10 + "px Arial";
				ctx.fillStyle = "#000000";
				ctx.textAlign="center";
				ctx.textBaseline = "middle";
				ctx.fillText(`${winner} has won!`, canvas.width / 2, canvas.height / 6);
			}

			function drawBall() {
				ctx.beginPath();
				ctx.arc(x, y, ballRadius, 0, Math.PI * 2);
				ctx.fillStyle = "#0095DD";
				ctx.fill();
				ctx.closePath();
			}

			function draw() {
				ctx.clearRect(0, 0, canvas.width, canvas.height);
				drawBall();
				drawLeftPaddle();
				drawRightPaddle();
				drawScore();
				x += dx;
				y += dy;
				if (x + dx - (paddleWidth / 2) < ballRadius)
				{
					if (y > leftPaddle && y < leftPaddle + paddleHeight)
					{
						relativeIntersectionY = (leftPaddle + (paddleHeight / 2)) - y;
						normalizedIntersectionY = (relativeIntersectionY / (paddleHeight / 2));
						bounceAngle = normalizedIntersectionY * (5*Math.PI/12);
						if (ballSpeed < canvas.width / 100)
							ballSpeed += 0.2;
						dx = ballSpeed*Math.cos(bounceAngle);
						dy = ballSpeed*-Math.sin(bounceAngle);
					}
					else
					{
						rightScore++;
						if (rightScore === 3)
						{
							ctx.clearRect(0, 0, canvas.width, canvas.height);
							clearInterval(interval);
							winner = player2;
							resetGame();
							interval = setInterval(drawMenu, 10);
							//return ;
							//alert("GAME OVER : PLAYER 2 HAS WON");
							//document.location.reload();
							//clearInterval(interval);
						}
						else
						{
							clearInterval(interval);
							interval = null;
							x = canvas.width / 2;
							y = canvas.height - 10;
							dx = -1 * (canvas.width / 2) / 200;
							dy = -1 * (canvas.height / 2) / 200;
							leftPaddle = (canvas.height - paddleHeight) /2;
							rightPaddle = (canvas.height - paddleHeight) /2;
							ballSpeed = canvas.width / 250;
							interval = setInterval(draw, 8);
						}
					}
				}
				else if (x + dx > canvas.width - ballRadius - (paddleWidth / 2))
				{
					if (y > rightPaddle && y < rightPaddle + paddleHeight)
					{
						relativeIntersectionY = (rightPaddle + (paddleHeight / 2)) - y;
						normalizedIntersectionY = (relativeIntersectionY / (paddleHeight / 2));
						bounceAngle = normalizedIntersectionY * (5*Math.PI/12);
						if (ballSpeed < canvas.width / 100)
							ballSpeed += 0.2;
						dx = -ballSpeed*Math.cos(bounceAngle);
						dy = ballSpeed*-Math.sin(bounceAngle);
					}
					else
					{
						leftScore++;
						if (leftScore === 3)
						{
							ctx.clearRect(0, 0, canvas.width, canvas.height);
							clearInterval(interval);
							winner = player1;
							resetGame();
							interval = setInterval(drawMenu, 10);
							//return ;
							//alert("GAME OVER : PLAYER 1 HAS WON");
							//document.location.reload();
							//clearInterval(interval);
						}
						else
						{
							clearInterval(interval);
							interval = null;
							x = canvas.width / 2;
							y = canvas.height - 10;
							dx = (canvas.width / 2) / 200;
							dy = -1 * ((canvas.height / 2) / 200);
							leftPaddle = (canvas.height - paddleHeight) / 2;
							rightPaddle = (canvas.height - paddleHeight) / 2;
							ballSpeed = canvas.width / 250;
							interval = setInterval(draw, 8);
						}
					}
				}
				if (y + dy > canvas.height - ballRadius || y + dy < ballRadius)
					dy = -dy;

				if (leftPaddleRightPressed)
				{
					leftPaddle = Math.min(leftPaddle + 7, canvas.height - paddleHeight);
				}
				else if (leftPaddleLeftPressed)
				{
					leftPaddle = Math.max(leftPaddle - 7, 0);
				}

				if (rightPaddleRightPressed)
				{
					rightPaddle = Math.min(rightPaddle + 7, canvas.height - paddleHeight);
				}
				else if (rightPaddleLeftPressed)
				{
					rightPaddle = Math.max(rightPaddle - 7, 0);
				}
			}

			function drawLeftPaddle() {
				ctx.beginPath();
				ctx.rect(0, leftPaddle, paddleWidth, paddleHeight);
				ctx.fillStyle = "#0095DD";
				ctx.fill();
				ctx.closePath();
			}

			function drawRightPaddle()
			{
				ctx.beginPath();
				ctx.rect(canvas.width - paddleWidth, rightPaddle, paddleWidth, paddleHeight);
				ctx.fillStyle = "#0095DD";
				ctx.fill();
				ctx.closePath();
			}

			function drawScore() {
				ctx.font = "16px Arial";
				ctx.fillStyle = "#0095DD";
				ctx.textAlign = "left";
				ctx.textBaseline = "left";
				ctx.fillText(`Player 1: ${leftScore}`, 8, 20);
				ctx.fillText(`Player 2: ${rightScore}`, 8, 40);
			}


			document.addEventListener("keydown", keyDownHandler, false);
			document.addEventListener("keyup", keyUpHandler, false);
			document.addEventListener("mousemove", mouseMoveHandler, false);
			document.addEventListener("click", mouseClickHandler, false);

			function mouseMoveHandler(e)
			{
				const relativeX = e.clientX - canvas.offsetLeft;
				const relativeY = e.clientY - canvas.offsetTop;

				if (relativeX > canvas.width/3 && relativeX < 2*canvas.width/3 && relativeY > canvas.height/3 && relativeY < 2*canvas.height/3)
				{
					boxHover = true;
				}
				else
				{
					boxHover = false;
				}
			}

			function mouseClickHandler(e)
			{
				const relativeX = e.clientX - canvas.offsetLeft;
				const relativeY = e.clientY - canvas.offsetTop;

				if (relativeX > canvas.width/3 && relativeX < 2*canvas.width/3 && relativeY > canvas.height/3 && relativeY < 2*canvas.height/3 && menuBool === true)
				{
					menuBool = false;
					winner = 0;
					ctx.clearRect(0, 0, canvas.width, canvas.height);
					clearInterval(interval);
					interval = setInterval(draw, 8);
				}
			}
			function keyDownHandler(e) {
				if (e.key === "Right" || e.key === "ArrowRight")
				{
					rightPaddleLeftPressed = true;
				}
				else if (e.key === "q" || e.key === "Q")
				{
					leftPaddleLeftPressed = true;
				}
				else if (e.key === "e" || e.key === "E")
				{
					leftPaddleRightPressed = true;
				}
				else if (e.key === "Left" || e.key === "ArrowLeft")
				{
					rightPaddleRightPressed = true;
				}
			}

			function keyUpHandler(e) {
				if (e.key === "Right" || e.key === "ArrowRight")
				{
					rightPaddleLeftPressed = false;
				}
				else if (e.key === "q" || e.key === "Q")
				{
					leftPaddleLeftPressed = false;
				}
				else if (e.key === "e" || e.key === "E")
				{
					leftPaddleRightPressed = false;
				}
				else if (e.key === "Left" || e.key === "ArrowLeft")
				{
					rightPaddleRightPressed = false;
				}
			}
			interval = setInterval(drawMenu, 10);
		</script>
	</body>
</html>

